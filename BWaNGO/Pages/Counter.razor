@inject Blazored.LocalStorage.ILocalStorageService LocalStorageService

@page "/counter"

<PageTitle>Counter</PageTitle>

<MudText Typo="Typo.h2">Counter</MudText>
<br/>

<MudText Typo="Typo.body1" role="status">Curent count: @_currentCount</MudText>

<MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="IncrementCount">Increment</MudButton>
<MudButton Variant="Variant.Outlined" Color="Color.Error" OnClick="ResetCount">Reset</MudButton>

@code {
    private const string CounterKey = "Counter";

    private int _currentCount;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            _currentCount = await LocalStorageService.GetItemAsync<int>(CounterKey);
        }
        catch (Exception e)
        {
            Console.WriteLine("Error retrieving counter from local storage, clearing: " + e.Message);
            await ResetCount();
        }
        await base.OnInitializedAsync();
    }

    private async Task IncrementCount()
    {
        _currentCount++;
        await LocalStorageService.SetItemAsync(CounterKey, _currentCount);
    }

    private async Task ResetCount()
    {
        _currentCount = 0;
        await LocalStorageService.RemoveItemAsync(CounterKey);
    }
}