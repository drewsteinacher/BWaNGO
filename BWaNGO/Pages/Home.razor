@inject IBingoBoardRepository BingoBoardRepository
@inject ILabelsRepository LabelsRepository
@inject IBingoBoardGenerator BingoBoardGenerator

@page "/"
@using BWaNGO.Models
@using BWaNGO.Repositories
@using BWaNGO.Components
@using BWaNGO.Generation
@using BWaNGO.Generation.Presets

<PageTitle>Home</PageTitle>

@if (_board is null && _labels.Count == 0)
{
    <MudText>No labels found! Add some labels on <MudLink Href="Labels">the Labels page</MudLink>.</MudText>
    return;
}

<BingoBoardComponent
    @bind-Board="_board"
    @bind-Board:after="OnBoardChanged"
    IsEditMode="_isEditMode"
/>

@code {
    private BingoBoard? _board;
    private List<string> _labels = [];
    private bool _isEditMode = false;

    protected override async Task OnInitializedAsync()
    {
        _board = await BingoBoardRepository.Get();
        if (_board is null)
        {
            _labels = await LabelsRepository.Get();
            if (_labels.Count > 0)
            {
                GenerateBoard(_labels);
            }
        }

        await base.OnInitializedAsync();
    }

    private void GenerateBoard(List<string> labels)
    {
        _board = BingoBoardGenerator.Generate(labels, new StandardBingoPreset());
    }

    private Task OnBoardChanged()
        => BingoBoardRepository.SaveAsync(_board);
}
