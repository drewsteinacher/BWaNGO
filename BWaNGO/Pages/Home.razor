@inject IBingoBoardRepository BingoBoardRepository
@inject ILabelsRepository LabelsRepository
@inject IBingoBoardGenerator BingoBoardGenerator

@page "/"
@using BWaNGO.Models
@using BWaNGO.Repositories
@using BWaNGO.Components
@using BWaNGO.Generation
@using BWaNGO.Generation.Presets

<PageTitle>Home</PageTitle>

@if (_board is null && _labels.Count == 0)
{
    <MudText>No labels found! Add some labels on <MudLink Href="Labels">the Labels page</MudLink>.</MudText>
}
else
{
    // TODO: Make the title editable after a click on something
    <MudTextField T="string" Text="Board Title Here" Typo="Typo.h3" Variant="Variant.Text"></MudTextField>
    
    <br/>
    
    // TODO: Review if this is the best way to organize/pass down information
    <BingoBoardComponent
        Board="_board"
        IsEditMode="_isEditMode"
        OnBoardChanged="newBoard => _board = newBoard"
    />
}

@code {
    private BingoBoard? _board;
    private List<string> _labels = [];
    private bool _isEditMode = false;
    
    protected override async Task OnInitializedAsync()
    {
        _board = await BingoBoardRepository.Get();
        if (_board is null)
        {
            _labels = await LabelsRepository.Get();
            if (_labels.Count > 0)
            {
                GenerateBoard(_labels);
            }
        }

        await base.OnInitializedAsync();
    }

    private void GenerateBoard(List<string> labels)
    {
        _board = BingoBoardGenerator.Generate(labels, new StandardBingoPreset());
    }

}
